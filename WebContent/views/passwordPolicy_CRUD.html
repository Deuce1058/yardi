<!DOCTYPE html>
<html>

<head>
  <meta HTTP-EQUIV="Pragma" CONTENT="no-cache">
  <meta HTTP-EQUIV="Expires" CONTENT="-1">
  <title>Password Policy CRUD</title>
  <!-- 
  https://www.tutorialrepublic.com/codelab.php?topic=bootstrap&file=scrollspy
  https://www.tutorialrepublic.com/twitter-bootstrap-tutorial/bootstrap-affix.php
  https://www.tutorialrepublic.com/css-reference/css-top-property.php
  -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="../resources/css/bootstrap.min.css" rel="stylesheet" />
  <script src="../resources/scripts/jquery-3.4.1.min.js"></script>
  <script src="../resources/scripts/bootstrap.min.js"></script>
  <style type="text/css">
    body {
      padding-top: 0px;
    }

    .userProfileForm {
      margin-left: 0px;
    }

    .formElementPadBottom {
      padding-bottom: 10px;
    }

    .formElementPadLeft {
      padding-left: 5px;
    }

    .formElementPadBottomLeft {
      padding-bottom: 10px;
      padding-left: 5px;
    }

    .roundedCorners {
      border-color: black;
      border-radius: 5px;
      border-style: solid;
      border-width: 1px;
    }

    .preserveWhiteSpace {
      white-space: pre;
    }

    .dropdown-submenu {
      position: relative;
    }

    .dropdown-submenu>.dropdown-menu {
      top: 0;
      left: 100%;
      margin-top: -6px;
      margin-left: -1px;
      -webkit-border-radius: 0 6px 6px 6px;
      -moz-border-radius: 0 6px 6px;
      border-radius: 0 6px 6px 6px;
    }

    .dropdown-submenu:hover>.dropdown-menu {
      display: block;
    }

    .dropdown-submenu>a:after {
      display: block;
      content: " ";
      float: right;
      width: 0;
      height: 0;
      border-color: transparent;
      border-style: solid;
      border-width: 5px 0 5px 5px;
      border-left-color: #ccc;
      margin-top: 5px;
      margin-right: -10px;
    }

    .dropdown-submenu:hover>a:after {
      border-left-color: #fff;
    }

    .dropdown-submenu.pull-left {
      float: none;
    }

    .dropdown-submenu.pull-left>.dropdown-menu {
      left: -100%;
      margin-left: 10px;
      -webkit-border-radius: 6px 0 6px 6px;
      -moz-border-radius: 6px 0 6px 6px;
      border-radius: 6px 0 6px 6px;
    }

    .not-allowed {
      cursor: not-allowed;
    }

    .pointer {
      cursor: pointer;
    }

    .white {
      color: white;
    }

    .align-center {
      text-align: center;
    }

    .background-red {
      background-color: red;
    }

    .error-border {
      border-style: solid;
      border-color: red;
      border-width: medium;
    }
  </style>
  <h4 class="white align-center background-red">
    <noscript>This site requires JavaScript. Ensure that this is enabled on your browser.</noscript>
  </h4>
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom border-bottom">
    <a class="navbar-brand" href="#">Navbar</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav">
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown"
            aria-haspopup="true" aria-expanded="false">
            Quick Links<span class="caret"></span>
          </a>
          <ul class="dropdown-menu  multi-level" style="width: 150px;" role="menu" aria-labelledby="dropdownMenu">
            <li class="dropdown-submenu">
              <a tabindex="-1" href="#">User Tables</a>
              <ul class="dropdown-menu" style="width: 250px;">
                <li id="UPView"><a href="#">View User Profile</a></li>
                <li id="UPChange"><a href="#">User Profile Maintenance</a></li>
                <li id="STView"><a href="#">View Sessions Table</a></li>
                <li id="STChange"><a href="#">Sessions Table Maintenance</a></li>
                <li id="UP1View"><a href="#">View Unique Tokens Table</a></li>
                <li id="UP1Change"><a href="#">Unique Tokens Table Maintenance</a></li>
                <li id="UGView"><a href="#">View User Groups Table</a></li>
                <li id="UGChange"><a href="#">User Groups Table Maintenance</a></li>
              </ul>
            </li>

            <li class="dropdown-submenu">
              <a href="#">Permissions</a>
              <ul class="dropdown-menu" style="width: 250px;">
                <li id="PMView"><a href="#">View Permissions Master</a></li>
                <li id="PMChange"><a href="#">Permissions Master Maintenance</a></li>
                <li id="GPView"><a href="#">View Group Permissions</a></li>
                <li id="GPChange"><a href="#">Group Permissions Maintenance</a></li>
              </ul>
            </li>

            <li class="dropdown-submenu">
              <a href="#">Misc.</a>
              <ul class="dropdown-menu" style="width: 250px;">
                <li id="GMView"><a href="#">View Group Master</a></li>
                <li id="GMChange"><a href="#">Group Master Maintenance</a></li>
                <li id="PPView"><a href="#">View Password Policy</a></li>
                <li id="PPChange"><a href="#">Password Policy Maintenance</a></li>
                <li id="STView"><a href="#">View Sessions Table</a></li>
                <li id="STChange"><a href="#">Sessions Table Maintenance</a></li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
      <form class="form-inline pl-2">
        <h4>Password Policy</h4>
      </form>
      <div class="d-inline-flex flex-sm-column">
        <div id="title-loginID" class="pb-sm-1 preserveWhiteSpace"></div>
        <div id="form-feedback" style="color:red; margin-left: 47px">
          *...+ .. 1 .. + .. 2 .. + .. 3 .. + .. 4 .. + .. 5 .. + .. 6 .. + .. 7 .. + .. 8 .. + .. 9
        </div>
        <!--90 char-->
      </div>
    </div>
  </nav>
  <div id="pwdOptions">
    <form class="form-inline m-sm-3" id="optionsForm">
      <div class="form-group m-sm-3">
        <input type="text" class="roundedCorners form-control-sm numeric gtzero" id="PPDays" name="PPDays" maxlength="3"
          size="1" required>
        <label class="pl-sm-2" for="PPDays">Password life in days</label>
      </div>
      <div class="form-group m-sm-3">
        <input type="text" class="roundedCorners form-control-sm numeric gezero" id="PPNbrUnique" name="PPNbrUnique"
          maxlength="3" size="1" required>
        <label class="pl-sm-2" for="PPNbrUnique">Number of unique tokens</label>
      </div>
      <div class="form-group m-sm-3">
        <input type="text" class="roundedCorners form-control-sm numeric gtzero" id="PPMaxLoginTries"
          name="PPMaxLoginTries" maxlength="2" size="1" required>
        <label class="pl-sm-2" for="PPMaxLoginTries">Max number of login attempts</label>
      </div>
      <div class="form-group m-sm-3">
        <input type="text" class="roundedCorners form-control-sm numeric gtzero" id="PPPwdMinLen" name="PPPwdMinLen"
          maxlength="3" size="1" required>
        <label class="pl-sm-2" for="PPPwdMinLen">Minimum password length</label>
      </div>
      <div class="form-group m-sm-3">
        <input type="text" class="roundedCorners form-control-sm gtzero null" id="PPPwdMaxLen" name="PPPwdMaxLen"
          maxlength="4" size="1" required>
        <label class="pl-sm-2" for="PPPwdMAxLen">Maximum password length</label>
      </div>
      <div class="form-group m-sm-3">
        <input type="text" class="roundedCorners form-control-sm gezero null" id="PPNbrRepeats" name="PPNbrRepeats"
          maxlength="4" size="1" required>
        <label class="pl-sm-2" for="PPNbrRepeats">Maximum repeated characters</label>
      </div>
      <div class="form-group m-sm-3">
        <input type="text" class="roundedCorners form-control-sm gtzero null" id="PPNbrNbr" name="PPNbrNbr"
          maxlength="4" size="1" required>
        <label class="pl-sm-2" for="PPNbrNbr">Number of digits</label>
      </div>
      <div class="form-group m-sm-3">
        <input type="text" class="roundedCorners form-control-sm gtzero null" id="PPNbrUpper" name="PPNbrUpper"
          maxlength="4" size="1" required>
        <label class="pl-sm-2" for="PPNbrUpper">Number of upper case</label>
      </div>
      <div class="form-group m-sm-3">
        <input type="text" class="roundedCorners form-control-sm gtzero null" id="PPNbrLower" name="PPNbrLower"
          maxlength="4" size="1" required>
        <label class="pl-sm-2" for="PPNbrLower">Number of lower case</label>
      </div>
      <div class="form-group m-sm-3">
        <input type="text" class="roundedCorners form-control-sm gtzero null" id="PPNbrSpecial" name="PPNbrSpecial"
          maxlength="4" size="1" required>
        <label class="pl-sm-2" for="PPNbrSpecial">Number of special characters</label>
      </div>
      <div class="form-group custom-control custom-checkbox m-sm-3">
        <input type="checkbox" class="custom-control-input" id="PPUpperRqd" name="PPUpperRqd" value="PPUpperRqd">
        <label class="custom-control-label" for="PPUpperRqd">Upper case required</label>
      </div>
      <div class="form-group custom-control custom-checkbox m-sm-3">
        <input type="checkbox" class="custom-control-input" id="PPLowerRqd" name="PPLowerRqd" value="PPLowerRqd">
        <label class="custom-control-label" for="PPLowerRqd">Lower case required</label>
      </div>
      <div class="form-group custom-control custom-checkbox m-sm-3">
        <input type="checkbox" class="custom-control-input" id="PPNbrRqd" name="PPNbrRqd" value="PPNbrRqd">
        <label class="custom-control-label" for="PPNbrRqd">Number required</label>
      </div>
      <div class="form-group custom-control custom-checkbox m-sm-3">
        <input type="checkbox" class="custom-control-input" id="PPSpecialRqd" name="PPSpecialRqd" value="PPSpecialRqd">
        <label class="custom-control-label" for="PPSpecialRqd">Special character required</label>
      </div>
      <div class="form-group custom-control custom-checkbox m-sm-3">
        <input type="checkbox" class="custom-control-input" id="PPContainsUser" name="PPContainsUser"
          value="PPContainsUser">
        <label class="custom-control-label" for="PPContainsUser">Cant contain user name</label>
      </div>
      <div class="form-group custom-control custom-checkbox m-sm-3">
        <input type="checkbox" class="custom-control-input" id="PPContainsPwd" name="PPContainsPwd"
          value="PPContainsPwd">
        <label class="custom-control-label" for="PPContainsPwd">Cant contain current password</label>
      </div>
    </form>
  </div>
  <div class="flex-row m-sm-3" id="buttonPanel" name="buttonPanel">
    <button type="button" class="btn btn-success login-btn-margin" id="submitBtn">Submit</button>
  </div>
  <div class="modal fade" id="jsCookiesAlert" tabindex="-1" role="dialog" aria-labelledby="jsCookiesAlert"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLongTitle">Notice:</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          This site requires cookies and JavaScript. Ensure that these are enabled on your browser.
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Dismiss</button>
        </div>
      </div>
    </div>
  </div>
  <script>
    var formData;
    var formItems;
    var ajaxData;
    var viewMode = false;
    var action;
    
    $(function () {

      if (navigator.cookieEnabled == false) {
        $('#jsCookiesAlert').modal('show');
      }

      configureViewMode();
      setFormItems('', '');
      setFormData();
      doPost();
      $('.navbar-brand').click(function () {
        newFrame('views/QSECOFR_Main.html');
      });
      $('#UPView').click(function () {
        newFrame('views/userProfile_CRUD.html?mode=view');
      });
      $('#UPChange').click(function () {
        newFrame('views/userProfile_CRUD.html');
      });
      $('#STView').click(function () {
        newFrame('views/sessions_CRUD.html?mode=view');
      });
      $('#STChange').click(function () {
        newFrame('views/sessions_CRUD.html');
      });
      $('#UP1View').click(function () {
        newFrame('views/uniqueTokens_CRUD.html?mode=view');
      });
      $('#UP1Change').click(function () {
        newFrame('views/uniqueTokens_CRUD.html');
      });
      $('#UGView').click(function () {
        newFrame('views/userGroups_CRUD.html?mode=view');
      });
      $('#UGChange').click(function () {
        newFrame('views/userGroups_CRUD.html');
      });
      $('#PMView').click(function () {
        newFrame('views/permissionsMaster_CRUD.html?mode=view');
      });
      $('#PMChange').click(function () {
        newFrame('views/permissionsMaster_CRUD.html');
      });
      $('#GPView').click(function () {
        newFrame('views/groupPermissions_CRUD.html?mode=view');
      });
      $('#GPChange').click(function () {
        newFrame('views/groupPermissions_CRUD.html');
      });
      $('#GMView').click(function () {
        newFrame('views/groupMaster_CRUD.html?mode=view');
      });
      $('#GMChange').click(function () {
        newFrame('views/groupMaster_CRUD.html');
      });
      $('#PPView').click(function () {
        newFrame('views/passwordPolicy_CRUD.html?mode=view');
      });
      $('#PPChange').click(function () {
        newFrame('views/passwordPolicy_CRUD.html');
      });
      $('#submitBtn').click(function (e) {
        if (validateForm(e)) {
          setFormItems(action, ajaxData)
          setFormData();
          doPost();
        }
      });
    });

    function newFrame(newFrame) {
      $('html').html(newFrame);
      console.log(' nextFrame=' + newFrame);
      parent.frame = newFrame;
      parent.nextFrame();
    }

    function configureViewMode() {
      /**
        Protect input fields when:
          1. Its view mode 
          2. Its not view mode and the find button is enabled
      **/
      $('#title-loginID').text(parent.userName);
      viewMode = false;

      if (getAllUrlParams().mode === 'view') {
        viewMode = true;
        console.log('view mode');
        $('#title-loginID').text('VIEW MODE    ' + parent.userName);
      }

      /**
        Protect input fields when:
          1. Its view mode 
          2. Its not view mode and the find button is enabled
      **/
      /*
      if ((!viewMode) && (findButtonDisabled == false)) {
        //disable the rest of the input fields
      }
      */
    }

    function getAllUrlParams(url) {
      //see: https://www.sitepoint.com/get-url-parameters-with-javascript/
      // get query string from url (optional) or window
      var queryString = url ? url.split('?')[1] : window.location.search.slice(1);

      // we'll store the parameters here
      var obj = {};

      // if query string exists
      if (queryString) {

        // stuff after # is not part of query string, so get rid of it
        queryString = queryString.split('#')[0];

        // split our query string into its component parts
        var arr = queryString.split('&');

        for (var i = 0; i < arr.length; i++) {
          // separate the keys and the values
          var a = arr[i].split('=');

          // in case params look like: list[]=thing1&list[]=thing2
          var paramNum = undefined;
          var paramName = a[0].replace(/\[\d*\]/, function (v) {
            paramNum = v.slice(1, -1);
            return '';
          });

          // set parameter value (use 'true' if empty)
          var paramValue = typeof (a[1]) === 'undefined' ? true : a[1];

          // (optional) keep case consistent
          paramName = paramName.toLowerCase();
          paramValue = paramValue.toLowerCase();

          // if parameter name already exists
          if (obj[paramName]) {
            // convert value to array (if still string)
            if (typeof obj[paramName] === 'string') {
              obj[paramName] = [obj[paramName]];
            }
            // if no array index number specified...
            if (typeof paramNum === 'undefined') {
              // put the value on the end of the array
              obj[paramName].push(paramValue);
            }
            // if array index number specified...
            else {
              // put the value at that index number
              obj[paramName][paramNum] = paramValue;
            }
          }
          // if param name doesn't exist yet, set it
          else {
            obj[paramName] = paramValue;
          }
        }
      }

      return obj;
    }

    function validateForm(e) {
      var formValid = true;
      $('#form-feedback').text('');

      $('input').filter('.numeric, .null').each(function () {
        //change to lower case and strip leading, trailing and embeded whitespace
        $(this).val($(this).val().toLowerCase());
        $(this).val($(this).val().replace(/\s/g, ''));
      });

      $('input').each(function () {
        if (this.checkValidity()) {
          $(this).removeClass('error-border');
        } else {
          $('#form-feedback').text('A value is required');
          $(this).addClass('error-border');
          formValid = false;
        }
      });

      if (formValid) {
        $('input').each(function () {
          $(this).removeClass('error-border');

          if ($(this).hasClass('numeric') && isNotNumeric($(this).val())) {
            formValid = false;
            $(this).addClass('error-border');
            $('#form-feedback').text('A number is required');
          }

          if ($(this).hasClass('null') && !($(this).val() === 'null') && isNotNumeric($(this).val())) {
            formValid = false;
            $(this).addClass('error-border');
            $('#form-feedback').text('A number is required');
          }
        });
      }

      if (formValid) {
        $('input').each(function () {
          $(this).removeClass('error-border');

          if ($(this).hasClass('numeric') && isInt($(this).val()) === false) {
            formValid = false;
            $(this).addClass('error-border');
            $('#form-feedback').text('Must be an integer value');
          }

          if ($(this).hasClass('null') && !($(this).val() === 'null') && isInt($(this).val()) === false) {
            formValid = false;
            $(this).addClass('error-border');
            $('#form-feedback').text('Must be an integer value');
          }
        });
      }

      if (formValid) {
        $('input').each(function () {
          $(this).removeClass('error-border');

          if ($(this).hasClass('numeric')) {

            if (formValid && $(this).hasClass('gtzero') && $(this).val() <= 0) {
              formValid = false;
              $('#form-feedback').text('Value must be greater than zero');
              $(this).addClass('error-border');
            }

            if (formValid && $(this).hasClass('gezero') && $(this).val() < 0) {
              formValid = false;
              $('#form-feedback').text('Value must be greater than or equal to zero');
              $(this).addClass('error-border');
            }
          }

          if ($(this).is('.null.gtzero') && !($(this).val() === 'null') && $(this).val() <= 0) {
            $('#form-feedback').text('Value must be greater than zero');
            $(this).addClass('error-border');
            formValid = false;
          }
        });
      }

      if (formValid) {

        if (!($('#PPPwdMaxLen').val() === 'null') && (parseInt($('#PPPwdMinLen').val()) > parseInt($('#PPPwdMaxLen').val()))) {
          formValid = false;
          $('#PPPwdMaxLen').addClass('error-border');
          $('#PPPwdMinLen').addClass('error-border');
          $('#form-feedback').text('Minimum password length must be <= maximum password length');
        }

        if (formValid && !($('#PPPwdMaxLen').val() === 'null') && (parseInt($('#PPPwdMaxLen').val()) < parseInt($('#PPPwdMinLen').val()))) {
          formValid = false;
          $('#PPPwdMaxLen').addClass('error-border');
          $('#PPPwdMinLen').addClass('error-border');
          $('#form-feedback').text('Maximum password length must be >= minimum password length');
        }

        if (formValid && !($('#PPNbrRepeats').val() === 'null') && !($('#PPPwdMaxLen').val() === 'null') && (parseInt($('#PPNbrRepeats').val()) > parseInt($('#PPPwdMaxLen').val()))) {
          formValid = false;
          $('#PPNbrRepeats').addClass('error-border');
          $('#PPPwdMaxLen').addClass('error-border');
          $('#form-feedback').text('Maximum repeated characters must be <= maximum password length');
        }

        if (formValid && !($('#PPNbrNbr').val() === 'null') && !($('#PPPwdMaxLen').val() === 'null') && (parseInt($('#PPNbrNbr').val()) > parseInt($('#PPPwdMaxLen').val()))) {
          formValid = false;
          $('#PPNbrNbr').addClass('error-border');
          $('#PPPwdMaxLen').addClass('error-border');
          $('#form-feedback').text('Number of digits must be <= maximum password length');
        }

        if (formValid && !($('#PPNbrUpper').val() === 'null') && !($('#PPPwdMaxLen').val() === 'null') && (parseInt($('#PPNbrUpper').val()) > parseInt($('#PPPwdMaxLen').val()))) {
          formValid = false;
          $('#PPNbrUpper').addClass('error-border');
          $('#PPPwdMaxLen').addClass('error-border');
          $('#form-feedback').text('Number of upper case must be <= maximum password length');
        }

        if (formValid && !($('#PPNbrLower').val() === 'null') && !($('#PPPwdMaxLen').val() === 'null') && (parseInt($('#PPNbrLower').val()) > parseInt($('#PPPwdMaxLen').val()))) {
          formValid = false;
          $('#PPNbrLower').addClass('error-border');
          $('#PPPwdMaxLen').addClass('error-border');
          $('#form-feedback').text('Number of lower case must be <= maximum password length');
        }

        if (formValid && !($('#PPNbrSpecial').val() === 'null') && !($('#PPPwdMaxLen').val() === 'null') && (parseInt($('#PPNbrSpecial').val()) > parseInt($('#PPPwdMaxLen').val()))) {
          formValid = false;
          $('#PPNbrSpecial').addClass('error-border');
          $('#PPPwdMaxLen').addClass('error-border');
          $('#form-feedback').text('Number of special characters must be <= maximum password length');
        }
      }

      if (formValid) {
        var n = 0;

        if (!($('#PPPwdMaxLen').val() === 'null') && !($('#PPNbrRepeats').val() === 'null')) {
          n += parseInt($('#PPNbrRepeats').val());
        }

        if (!($('#PPPwdMaxLen').val() === 'null') && !($('#PPNbrNbr').val() === 'null')) {
          n += parseInt($('#PPNbrNbr').val());
        }

        if (!($('#PPPwdMaxLen').val() === 'null') && !($('#PPNbrUpper').val() === 'null')) {
          n += parseInt($('#PPNbrUpper').val());
        }

        if (!($('#PPPwdMaxLen').val() === 'null') && !($('#PPNbrLower').val() === 'null')) {
          n += parseInt($('#PPNbrLower').val());
        }

        if (!($('#PPPwdMaxLen').val() === 'null') && !($('#PPNbrSpecial').val() === 'null')) {
          n += parseInt($('#PPNbrSpecial').val());
        }

        if (!($('#PPPwdMaxLen').val() === 'null') && n > parseInt($('#PPPwdMaxLen').val())) {
          $('#PPPwdMaxLen').addClass('error-border');
          $('#PPNbrRepeats').addClass('error-border');
          $('#PPNbrNbr').addClass('error-border');
          $('#PPNbrUpper').addClass('error-border');
          $('#PPNbrLower').addClass('error-border');
          $('#PPNbrSpecial').addClass('error-border');
          formValid = false;
          $('#form-feedback').text('Combined total must be <= maximum password length');
        }
      }

      if (formValid && !($('#PPUpperRqd').is(':checked')) && !($('#PPNbrUpper').val() === 'null')) {
        $('#PPUpperRqd').addClass('error-border');
        $('#PPNbrUpper').addClass('error-border');
        formValid = false;
        $('#form-feedback').text('Number of upper case was specified but Upper case required was not checked');
      }

      if (formValid && !($('#PPLowerRqd').is(':checked')) && !($('#PPNbrLower').val() === 'null')) {
        $('#PPLowerRqd').addClass('error-border');
        $('#PPNbrLower').addClass('error-border');
        formValid = false;
        $('#form-feedback').text('Number of lower case was specified but Lower case required was not checked');
      }

      if (formValid && !($('#PPNbrRqd').is(':checked')) && !($('#PPNbrNbr').val() === 'null')) {
        $('#PPNbrRqd').addClass('error-border');
        $('#PPNbrNbr').addClass('error-border');
        formValid = false;
        $('#form-feedback').text('Number of digits was specified but Number required was not checked');
      }

      if (formValid && !($('#PPSpecialRqd').is(':checked')) && !($('#PPNbrSpecial').val() === 'null')) {
        $('#PPSpecialRqd').addClass('error-border');
        $('#PPNbrSpecial').addClass('error-border');
        formValid = false;
        $('#form-feedback').text('Number of special characters was specified but Special character required was not checked');
      }

      if (formValid === false) {
        e.preventDefault();
        e.stopPropagation();
      }

      return formValid;
    }

    function isInt(i) {
      /*
      var x = "10.33";
      var y = "123";
      var z = "12.";
      var w = "5.0";
      if (x!=parseInt(x)) console.log("x is not an int"); // x is not an int
      if (y==parseInt(y)) console.log("y is an int"); //y is an int
      if (z==parseInt(z)) console.log("z is an int"); //z is an int
      if (w==parseInt(w)) console.log("w is an int"); //w is an int
      */
      var n = i;

      if (i == parseInt(n)) {
        return true;
      } else {
        return false;
      }
    }

    function isNotNumeric(n) {
      /*
      var a = "XXX";
      var n = "111";
      console.log(isNaN(a)); //true a is not numeric
      console.log(isNan(n)); //false n is numeric
      */
      return isNaN(n);
    }

    function setFormItems(action, data) {
      if (action === '') {
        action = 'find';
      }

      if (action === 'find') {
        formItems = {
          "action"           : "find",
          "msgId"            : "",
          "msgDescription"   : "",
          "pwdLifeInDays"    : "",
          "nbrUnique"        : "",
          "maxSignonAttempts": "",
          "pwdMinLen"        : "",
          "upperRqd"         : "",
          "lowerRqd"         : "",
          "nbrRqd"           : "",
          "specialRqd"       : "",
          "maxPwdLen"        : "",
          "maxRepeatChar"    : "",
          "nbrDigits"        : "",
          "nbrUpper"         : "",
          "nbrLower"         : "",
          "nbrSpecial"       : "",
          "cantContainId"    : "",
          "cantContainPwd"   : ""
        }
      } else {
        if (action === 'ajaxSuccess') {
          formItems = {
            "action"           : data.action,
            "msgId"            : data.msgId,
            "msgDescription"   : data.msgDescription,
            "pwdLifeInDays"    : data.pwdLifeInDays,
            "nbrUnique"        : data.nbrUnique,
            "maxSignonAttempts": data.maxSignonAttempts,
            "pwdMinLen"        : data.pwdMinLen,
            "upperRqd"         : data.upperRqd,
            "lowerRqd"         : data.lowerRqd,
            "nbrRqd"           : data.nbrRqd,
            "specialRqd"       : data.specialRqd,
            "maxPwdLen"        : data.maxPwdLen,
            "maxRepeatChar"    : data.maxRepeatChar,
            "nbrDigits"        : data.nbrDigits,
            "nbrUpper"         : data.nbrUpper,
            "nbrLower"         : data.nbrLower,
            "nbrSpecial"       : data.nbrSpecial,
            "cantContainId"    : data.cantContainId,
            "cantContainPwd"   : data.cantContainPwd
          }
        } else {
          formItems = {
            "action"           : action,
            "msgId"            : "",
            "msgDescription"   : "",
            "pwdLifeInDays"    : $('#PPDays').val(),
            "nbrUnique"        : $('#PPNbrUnique').val(),
            "maxSignonAttempts": $('#PPMaxLoginTries').val(),
            "pwdMinLen"        : $('#PPPwdMinLen').val(),
            "upperRqd"         : "n",
            "lowerRqd"         : "n",
            "nbrRqd"           : "n",
            "specialRqd"       : "n",
            "maxPwdLen"        : $('#PPPwdMaxLen').val(),
            "maxRepeatChar"    : $('#PPNbrRepeats').val(),
            "nbrDigits"        : $('#PPNbrNbr').val(),
            "nbrUpper"         : $('#PPNbrUpper').val(),
            "nbrLower"         : $('#PPNbrLower').val(),
            "nbrSpecial"       : $('#PPNbrSpecial').val(),
            "cantContainId"    : "n",
            "cantContainPwd"   : "n"
          }

          if ($('#PPUpperRqd').is(':checked')) {
            formItems.upperRqd = 'y';
          }

          if ($('#PPLowerRqd').is(':checked')) {
            formItems.lowerRqd = 'y';
          }

          if ($('#PPNbrRqd').is(':checked')) {
            formItems.nbrRqd = 'y';
          }

          if ($('#PPSpecialRqd').is(':checked')) {
            formItems.specialRqd = 'y';
          }

          if ($('#PPContainsUser').is(':checked')) {
            formItems.cantContainId = 'y';
          }

          if ($('#PPContainsPwd').is(':checked')) {
            formItems.cantContainPwd = 'y';
          }
        }
      }
    }

    function buildPage() {
      $('#PPDays')         .val(formItems.pwdLifeInDays);
      $('#PPNbrUnique')    .val(formItems.nbrUnique);
      $('#PPMaxLoginTries').val(formItems.maxSignonAttempts);
      $('#PPPwdMinLen')    .val(formItems.pwdMinLen);
      $('#PPPwdMaxLen')    .val(formItems.maxPwdLen);
      $('#PPNbrRepeats')   .val(formItems.maxRepeatChar);
      $('#PPNbrNbr')       .val(formItems.nbrDigits);
      $('#PPNbrUpper')     .val(formItems.nbrUpper);
      $('#PPNbrLower')     .val(formItems.nbrLower);
      $('#PPNbrSpecial')   .val(formItems.nbrSpecial);

      if (formItems.upperRqd === 'y' || formItems.upperRqd === 'Y') {
        $('#PPUpperRqd').attr('checked', 'checked');
      } else {
        $('#PPUpperRqd').removeAttr('checked');
      }

      if (formItems.lowerRqd === 'y' || formItems.lowerRqd === 'Y') {
        $('#PPLowerRqd').attr('checked', 'checked');
      } else {
        $('#PPLowerRqd').removeAttr('checked');
      }

      if (formItems.nbrRqd === 'y' || formItems.nbrRqd === 'Y') {
        $('#PPNbrRqd').attr('checked', 'checked');
      } else {
        $('#PPNbrRqd').removeAttr('checked');
      }

      if (formItems.specialRqd === 'y' || formItems.specialRqd === 'Y') {
        $('#PPSpecialRqd').attr('checked', 'checked');
      } else {
        $('#PPSpecialRqd').removeAttr('checked');
      }

      if (formItems.cantContainId === 'y' || formItems.cantContainId === 'Y') {
        $('#PPContainsUser').attr('checked', 'checked');
      } else {
        $('#PPContainsUser').removeAttr('checked');
      }

      if (formItems.cantContainPwd === 'y' || formItems.cantContainPwd === 'Y') {
        $('#PPContainsPwd').attr('checked', 'checked');
      } else {
        $('#PPContainsPwd').removeAttr('checked');
      }
    }

    function setFormData() {
      formData = JSON.stringify(formItems);
    }

    function doPost() {
      $.ajax({
        type: 'POST',
        url: '../PwdPolicy',
        data: formData,
        dataType: "json",
        success: function (ajaxData) {
          action = ajaxData.action;
          ajaxSuccess(ajaxData);
        }
      });
    }

    function ajaxSuccess(data) {
      setFormItems('ajaxSuccess', data);
      buildPage();
    }

  </script>
</body>

</html>